{% extends 'base.html' %}

{% block content %}
<style>
    /* Hide arrows/spinners */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type=number] {
        -moz-appearance: textfield;
    }
</style>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="card card-custom p-4 p-md-5">
                <div class="text-center mb-4">
                    <div class="mb-4">
                        <i class="fas fa-lock text-primary" style="font-size: 3rem;"></i>
                    </div>
                    <h2 class="fw-bold">Forgot Password?</h2>
                    <p class="text-muted">Enter the email associated with your account and we'll help you reset it.</p>
                </div>

                <form action="/forgetpassword" method="POST">

                    {% csrf_token %}

                    {% if error%}
                    <div class="alert alert-danger" role="alert">
                        {{error}}
                    </div>
                    {% endif %}

                    {% if success %}
                    <div class="alert alert-success" role="alert">
                        {{success}}
                    </div>
                    {% endif %}

                    {% if step == 'otp' %}
                    <!-- Step 2: OTP & Password Reset -->
                    <input type="hidden" name="action" value="reset_password">
                    <input type="hidden" name="email" value="{{email}}">



                    <div class="mb-3">
                        <label for="otp" class="form-label">Verification Code (OTP)</label>
                        <input type="number" name="otp" id="otp"
                            class="form-control form-control-lg text-center letter-spacing-2" placeholder="XXXX"
                            required
                            oninput="javascript: if (this.value.length > 4) this.value = this.value.slice(0, 4);">
                    </div>

                    <div class="mb-4">
                        <label for="password" class="form-label">New Password</label>
                        <input type="password" name="password" id="password" class="form-control form-control-lg"
                            placeholder="Enter new password" required>
                    </div>

                    <div class="d-grid gap-2">
                        <button class="btn btn-primary-custom btn-lg" type="submit">Verify & Reset Password</button>
                        <a href="/forgetpassword" class="btn btn-link text-decoration-none text-muted">Resend / Change
                            Email</a>
                    </div>

                    {% else %}
                    <!-- Step 1: Email Validation -->
                    <input type="hidden" name="action" value="validate_email">

                    <div class="mb-4">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" name="email" id="email" class="form-control form-control-lg"
                            placeholder="name@example.com" required>
                    </div>

                    <div class="d-grid gap-2">
                        <button class="btn btn-primary-custom btn-lg" type="submit">Send Verification Code</button>
                        <a href="/login" class="btn btn-outline-secondary btn-lg">Back to Login</a>
                    </div>
                    {% endif %}

                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}