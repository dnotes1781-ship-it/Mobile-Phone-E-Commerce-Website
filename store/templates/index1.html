{% extends 'base.html' %}

{% block content %}

{% load cart %}
{% load custom_filter %}

<div class="container py-5">
	<div class="row">

		<!-- Sidebar Filters -->
		<div class="col-lg-3 mb-4">
			<div class="card card-custom p-3 sticky-top" style="top: 100px; z-index: 1;">
				<h5 class="mb-3">Categories</h5>
				<div class="list-group list-group-flush">
					<a href="/store1"
						class="list-group-item list-group-item-action {% if not request.GET.category %}active{% endif %}">All
						Products</a>
					{% for category in categories %}
					<a href="/store1?category={{category.id}}"
						class="list-group-item list-group-item-action {% if request.GET.category == category.id|stringformat:'s' %}active{% endif %}">
						{{category.name}}
					</a>
					{% endfor %}
				</div>
			</div>
		</div>

		<!-- Products Grid -->
		<div id='products' class="col-lg-9">
			<div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
				{% for product in products %}
				<div class="col" id="{{product.id}}">
					<div class="card card-custom h-100">
						<a href="/product/{{product.id}}" class="text-decoration-none">
							<img src="{{product.image.url}}" class="card-img-top card-img-top-custom"
								alt="{{product.name}}">
						</a>
						<div class="card-body card-body-custom d-flex flex-column text-center">
							<h5 class="card-title mb-2">{{product.name}}</h5>
							<p class="card-text text-primary-custom fw-bold fs-5 mb-4">{{product.price|currency}}</p>

							<div class="mt-auto">
								{% if product|is_in_cart:request.session.cart %}
								<div
									class="d-flex justify-content-between align-items-center bg-light rounded p-2 border">
									<form action="/#{{product.id}}" method="post">
										{% csrf_token %}
										<input hidden type="text" name='product' value='{{product.id}}'>
										<input hidden type="text" name='remove' value='True'>
										<button type="submit" class="btn btn-sm btn-outline-secondary border-0"><i
												class="fas fa-minus"></i></button>
									</form>
									<span class="fw-bold">{{product|cart_quantity:request.session.cart}}</span>
									<form action="/#{{product.id}}" method="post">
										{% csrf_token %}
										<input hidden type="text" name='product' value='{{product.id}}'>
										<button type="submit" class="btn btn-sm btn-outline-primary border-0"><i
												class="fas fa-plus"></i></button>
									</form>
								</div>
								{% else %}
								<form action="/#{{product.id}}" method="POST" class="d-grid">
									{% csrf_token %}
									<input hidden type="text" name='product' value='{{product.id}}'>
									<button type="submit" class="btn btn-primary-custom w-100">Add To Cart</button>
								</form>
								{% endif %}
							</div>
						</div>
					</div>
				</div>
				{% endfor %}
			</div>
		</div>
	</div>
</div>

{% endblock %}